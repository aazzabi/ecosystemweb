{% extends 'base.html.twig' %}

{% block title %}
    Forum
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/forum/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/forum/custom.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/forum/settings.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/forum/sliderNormalize.css') }}">
    <style>
        #group-img {
            width: 55px !important;
            padding: 0;
        }
        #group-img img {
            width: 55px !important;
        }
        tr td{
            padding: 2px 3px !important;
        }
        #publcationsTab .archived td{
            background-color: rgba(255,165,0,0.37) !important;
        }
        /*background: #4a569d;*/
        /*background: -moz-linear-gradient(left, #4a569d 1%, #dc2424 100%);*/
        /*background: -webkit-linear-gradient(left, #4a569d 1%,#dc2424 100%);*/
        /*background: linear-gradient(to right, #4a569d 1%,#dc2424 100%);*/
        /*filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#4a569d',*/

        .navigation li, a.page-link {
            text-align: center;
            color: #07c25f;
        }
        .page-item.active .page-link {
            background-color: #07c25f !important;
            border-color: #1dbb99 !important;
        }
    </style>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript">

        var revapi;

        jQuery(document).ready(function() {
            "use strict";
            revapi = jQuery('.tp-banner').revolution(
                {
                    delay: 15000,
                    startwidth: 1200,
                    startheight: 278,
                    hideThumbs: 10,
                    fullWidth: "on"
                });

        });	//ready
    </script>
    <script>
        $(document).ready(function () {
            var tableP = $('#publcationsTab').DataTable({
                "paging": true,
                "stateSave": true,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.13/i18n/French.json",
                }
            });
        });
    </script>
    <script src="{{ asset ('assets/js/forum/jquery.themepunch.plugin.min.js') }}"></script>
    <script src="{{ asset ('assets/js/forum/jquery.themepunch.revolution.min.js') }}"></script>
    <script src="{{ asset ('assets/js/forum/sliderParticles.js') }}"></script>
    <script src="{{ asset('assets/js/jquery.js') }}" type="text/javascript"></script>
    <script>
        $(document).ready(function(){
            $(".keyWord").keyup(function () {
                var keyWord = $(this).val();
                $.ajax({
                    dataType: "json",
                    url : '{{ path('front_forum_recherche') }}',
                    data: {
                        "keyWord": keyWord
                    },
                    success:function(response) {
                        $("#postContent").html(response);
                    },
                });
            });
        });
    </script>

{% endblock %}

{% block body %}

    <div class="container-fluid">
        <div class="headernav" id="particles-js" style="height: 300px;" >
            <div class="content row">
                    <div class="col-lg-4 search hidden-xs hidden-sm col-md-3 offset-md-5">
                        <div class="wrap">
                            <form action="#" method="post" class="form">
                                <div class="pull-left txt"><input id="keyWord" type="text" class="keyWord form-control" placeholder="Recherche publications"></div>
                                <div class="pull-right"><button class="btn btn-default" type="button"><i class="fa fa-search"></i></button></div>
                            </form>
                        </div>
                    </div>
                {% if app.user %}
                    <div class="col-md-3 text-right">
                        <div class="stnt">
                            <a href="{{ path('front_forum_new') }}" class="btn btn-success">
                                <i class="icon-plus">
                                    <i class="fa fa-plus" aria-hidden="true"></i>
                                    &nbsp;Nouvelle publication
                                </i>
                            </a>
                        </div>
                    </div>
                {% else %}
                    <div class="col-md-3 text-right">
                        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#exampleModal">
                            <i class="icon-plus">
                                <i class="fa fa-plus" aria-hidden="true"></i>
                                &nbsp;Nouvelle publication
                            </i>
                        </button>
                    </div>

                {% endif %}
            </div>
        </div>

        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
             aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <i class="fa fa-exclamation fa-5x" style="color: red;margin: 0 auto;"></i>
                        <h5 class="modal-title" id="exampleModalLabel">Vous devez se connecter d'abord</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                        <a href="{{ path('inscription') }}">
                            <button class="btn btn-default">S'inscrire</button>
                        </a>
                        <a href="{{ path('fos_user_security_login') }}">
                            <button type="button" class="btn btn-primary">Se connecter</button>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <br>
            <div class="row">
                <div id="postContent" class="col-lg-8 col-md-8">
                    {% for publication in publications %}
                        <div class="post">
                            <div class="wrap-ut pull-left">
                                <div class="userinfo pull-left">
                                    {% if publication.publicationCreatedBy.photo %}
                                        <div class="avatar">
                                            <img src="{{ asset('uploads/user/photo/' ~ publication.publicationCreatedBy.photo) }}"
                                             width="55" height="55" alt="" />
                                        </div>
                                    {% else %}
                                        <div class="avatar">
                                            <img src="{{ asset('assets/img/profile.png') }}"
                                             width="55" height="55" alt="" />
                                        </div>
                                    {% endif %}
                                    {% if publication.etat == 'archiv√©' %}
                                        <br>
                                        <div class="icons" style="margin: 0 auto">
                                            <i class="fa fa-check-circle fa-2x" style="color: green"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="posttext pull-left">
                                    <a href="{{ path('front_forum_show', {'id' : publication.id }) }}"><h3 class="title" style="font-weight: 500;" >{{ publication.titre }}</h3></a>
                                    <p id="description">{{ publication.description }}</p>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="postinfo pull-left">
                                <div class="comments">
                                    <div class="commentbg">
                                        {{ publication.commentaires | length }}
                                        <div class="mark"></div>
                                    </div>
                                </div>
                                {% set difference = date(publication.publicationCreatedAt).diff(date())  %}

                                <div class="views"><i class="fa fa-eye"></i> {{ publication.nbrVues }} </div>
                                {% if difference.days == 0  %}
                                        <div class="time"><i class="fa fa-clock-o"></i> Aujourd'hui</div>
                                    {% elseif difference.days == 1 %}
                                        <div class="time"><i class="fa fa-clock-o"></i> Hier</div>
                                    {% else %}
                                        <div class="time"><i class="fa fa-clock-o"></i> Depuis {{ difference.days }} Jours</div>
                                {% endif %}
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    {% endfor %}
                </div>

                <div class="col-lg-4 col-md-4">
                    <div class="sidebarblock">
                        <h3>Categories</h3>
                        <div class="divline"></div>
                        <div class="blocktxt">
                            <ul class="cats">
                                {% for categorie in categories %}
                                    <li><a href="#">{{ categorie.libelle }}<span class="badge pull-right">{{ categorie.publicationsForum | length }}</span></a></li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>

                    <div class="sidebarblock">
                        <h3>Voir aussi : </h3>
                        {% for publication in publicationsArchivees %}
                            <div class="divline"></div>
                            <div class="blocktxt">
                                <a href="{{ path('front_forum_show', {'id' : publication.id }) }}">{{ publication.titre }}</a>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="navigation text-center">
                    {{ knp_pagination_render(publications) }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
